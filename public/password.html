<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuda - Enter Password</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="password-container">
        <div class="password-logo-section">
            <div class="password-logo">
                <img src="icons/kuda.png" alt="Kuda Logo">
            </div>
            <h1 class="password-title">Kuda</h1>
            <p class="password-subtitle">Mobile Money Transfer</p>
        </div>

        <div class="password-input-section">
            <h2>Enter Password</h2>
            <p class="password-description">Enter your 6-digit password to continue</p>

            <form class="password-form" id="passwordForm">
                <div class="password-input-wrapper">
                    <input
                        type="password"
                        id="passwordInput"
                        class="password-input-field"
                        placeholder="●●●●●●"
                        maxlength="6"
                        autocomplete="off"
                        inputmode="numeric"
                    >
                    <div class="password-error" id="passwordError">Incorrect password. Please try again.</div>
                </div>

                <button type="submit" class="password-submit-btn" id="submitBtn">
                    Unlock
                </button>
            </form>

            <p class="password-hint">Only numeric password is accepted</p>
        </div>

        <div class="password-footer">
            <p>Secure Login • All data encrypted</p>
        </div>
    </div>

    <script>
        const passwordForm = document.getElementById('passwordForm');
        const passwordInput = document.getElementById('passwordInput');
        const passwordError = document.getElementById('passwordError');
        const submitBtn = document.getElementById('submitBtn');

        // Auto-submit when 6 digits are entered
        passwordInput.addEventListener('input', (e) => {
            const value = e.target.value;

            // Remove any non-numeric characters
            const numericOnly = value.replace(/[^0-9]/g, '');
            passwordInput.value = numericOnly;

            // Auto-submit when 6 digits are entered
            if (numericOnly.length === 6) {
                submitForm();
            }
        });

        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            submitForm();
        });

        function submitForm() {
            const enteredPassword = passwordInput.value;

            if (enteredPassword.length !== 6) {
                return;
            }

            submitBtn.disabled = true;

            fetch('/api/verify-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: enteredPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    passwordError.classList.add('hidden');
                    window.location.href = '/dashboard';
                } else {
                    // Show error
                    passwordError.classList.remove('hidden');
                    passwordInput.value = '';
                    passwordInput.focus();
                    submitBtn.disabled = false;

                    // Hide error after 3 seconds
                    setTimeout(() => {
                        passwordError.classList.add('hidden');
                    }, 3000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                passwordError.classList.remove('hidden');
                passwordInput.value = '';
                passwordInput.focus();
                submitBtn.disabled = false;

                setTimeout(() => {
                    passwordError.classList.add('hidden');
                }, 3000);
            });
        }

        // Focus input on load
        window.addEventListener('load', () => {
            passwordInput.focus();
        });
    </script>
</body>
</html>
